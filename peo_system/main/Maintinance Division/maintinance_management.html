{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'CSS/styles.css' %}">
  <title>Maintenance Management</title>
  <style>
    :root {
      --bg: #edf1f5;
      --panel: #f8fafc;
      --line: #cfd6de;
      --text: #0f2238;
      --muted: #536982;
      --progress-track: #c7ced6;
      --progress-fill: #132e4d;
      --selected: #f7b333;
      --selected-text: #0f2238;
      --shadow: 0 1px 5px rgba(8, 34, 61, 0.12);
      --radius: 14px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Sora", "Segoe UI", sans-serif;
      color: var(--text);
      background: var(--bg);
    }

    .maintenance-dashboard {
      max-width: 1700px;
      margin: 0 auto;
      padding: 22px 18px 16px;
    }

    body.embedded-maintenance-view .maintenance-dashboard {
      padding-top: 10px;
    }

    .kpi-grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(4, minmax(200px, 1fr));
      margin-bottom: 16px;
    }

    .kpi-card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow);
      min-height: 112px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 14px;
    }

    .kpi-icon {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      flex: 0 0 auto;
    }

    .kpi-icon svg {
      width: 22px;
      height: 22px;
    }

    .i-road { background: #dde3ea; color: #173a60; }
    .i-len { background: #d5e2f8; color: #2767de; }
    .i-eq { background: #caecd8; color: #0a9a49; }
    .i-task { background: #f7e8bf; color: #de8500; }

    .kpi-value {
      font-size: clamp(1.6rem, 1.1vw + 1rem, 2.25rem);
      line-height: 1;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .kpi-label {
      margin-top: 4px;
      color: var(--muted);
      font-size: clamp(0.88rem, 0.38vw + 0.75rem, 1rem);
      line-height: 1.2;
    }

    .tabs {
      display: inline-flex;
      gap: 2px;
      border-radius: 12px;
      background: #dfe4ea;
      padding: 4px;
      margin-bottom: 10px;
    }

    .tab {
      border: 0;
      background: transparent;
      color: #0d233a;
      font-family: inherit;
      font-size: clamp(0.9rem, 0.42vw + 0.75rem, 1.02rem);
      line-height: 1;
      border-radius: 9px;
      padding: 10px 14px;
      cursor: pointer;
      white-space: nowrap;
    }

    .tab.active {
      background: #f8fafc;
      box-shadow: 0 1px 2px rgba(8, 34, 61, 0.12);
      font-weight: 600;
    }

    .condition-grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(4, minmax(200px, 1fr));
      margin-bottom: 16px;
    }

    .condition-card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 16px 14px;
    }

    .condition-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .condition-head h3 {
      margin: 0;
      font-size: clamp(0.95rem, 0.55vw + 0.75rem, 1.18rem);
      line-height: 1.15;
      font-weight: 600;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 36px;
      border-radius: 999px;
      padding: 4px 10px;
      font-weight: 600;
      font-size: clamp(0.8rem, 0.32vw + 0.68rem, 0.95rem);
      line-height: 1;
    }

    .good { background: #c9efd8; color: #07933f; }
    .fair { background: #cee0f7; color: #2159dc; }
    .poor { background: #f8e6bc; color: #ce7600; }
    .bad { background: #ed3343; color: #ffffff; }

    .progress {
      height: 10px;
      width: 100%;
      border-radius: 999px;
      background: var(--progress-track);
      overflow: hidden;
    }

    .progress > span {
      display: block;
      height: 100%;
      background: var(--progress-fill);
    }

    .p-good { width: 0%; }
    .p-fair { width: 0%; }
    .p-poor { width: 0%; }
    .p-bad { width: 0%; }

    .filter-card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 18px 14px;
    }

    .filter-row {
      display: grid;
      grid-template-columns: minmax(300px, 2fr) repeat(4, minmax(140px, 1fr));
      gap: 14px;
      align-items: center;
    }

    .search-field {
      display: flex;
      align-items: center;
      gap: 10px;
      border: 1px solid #c8d0d9;
      background: #f8fafc;
      border-radius: 12px;
      padding: 11px 12px;
      min-height: 52px;
    }

    .search-field svg {
      width: 21px;
      height: 21px;
      color: #677c93;
      flex: 0 0 auto;
    }

    .search-field input {
      width: 100%;
      border: 0;
      outline: none;
      background: transparent;
      color: #243d57;
      font-family: inherit;
      font-size: clamp(0.92rem, 0.35vw + 0.78rem, 1.02rem);
      line-height: 1.1;
    }

    .menu-select {
      position: relative;
    }

    .menu-button {
      width: 100%;
      border: 1px solid #c8d0d9;
      border-radius: 12px;
      background: #f8fafc;
      color: #102741;
      min-height: 52px;
      padding: 10px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-family: inherit;
      font-size: clamp(0.92rem, 0.35vw + 0.78rem, 1.02rem);
      line-height: 1.15;
      cursor: pointer;
    }

    .button-label {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .menu-button svg {
      width: 16px;
      height: 16px;
      color: #8b97a6;
      flex: 0 0 auto;
    }

    .menu-list {
      display: none;
      position: absolute;
      top: calc(100% + 6px);
      left: 0;
      width: 100%;
      min-width: 170px;
      max-height: 260px;
      overflow-y: auto;
      border: 1px solid #c8d0d9;
      border-radius: 10px;
      background: #f8fafc;
      box-shadow: 0 8px 20px rgba(8, 34, 61, 0.18);
      padding: 6px;
      z-index: 20;
    }

    .menu-select.open .menu-list {
      display: block;
    }

    .menu-option {
      width: 100%;
      border: 0;
      background: transparent;
      color: #1f2f40;
      border-radius: 8px;
      min-height: 40px;
      padding: 8px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-family: inherit;
      font-size: clamp(0.92rem, 0.35vw + 0.78rem, 1.02rem);
      line-height: 1.2;
      text-align: left;
      cursor: pointer;
    }

    .menu-option:hover {
      background: #edf1f6;
    }

    .menu-option.active {
      background: var(--selected);
      color: var(--selected-text);
    }

    .option-check {
      opacity: 0;
      font-weight: 700;
    }

    .menu-option.active .option-check {
      opacity: 1;
    }

    @media (max-width: 1280px) {
      .maintenance-dashboard {
        padding: 18px 14px 14px;
      }

      .kpi-grid,
      .condition-grid {
        grid-template-columns: repeat(2, minmax(220px, 1fr));
      }

      .filter-row {
        grid-template-columns: repeat(2, minmax(180px, 1fr));
      }

      .search-field {
        grid-column: 1 / -1;
      }
    }

    @media (max-width: 768px) {
      .maintenance-dashboard {
        padding: 12px 10px;
      }

      .kpi-grid,
      .condition-grid,
      .filter-row {
        grid-template-columns: 1fr;
      }

      .kpi-card {
        min-height: auto;
        padding: 14px 12px;
      }

      .condition-card {
        padding: 14px 12px;
      }

      .filter-card {
        padding: 12px;
      }

      .tabs {
        width: 100%;
        display: flex;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body{% if request.GET.embedded %} class="embedded-maintenance-view"{% endif %}>
  <main class="maintenance-dashboard">
    <section class="kpi-grid" aria-label="Maintenance summary cards">
      <article class="kpi-card">
        <div class="kpi-icon i-road" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><circle cx="18" cy="6" r="3" stroke="currentColor" stroke-width="2"/><circle cx="6" cy="12" r="3" stroke="currentColor" stroke-width="2"/><circle cx="18" cy="18" r="3" stroke="currentColor" stroke-width="2"/><path d="M8.6 10.8 15.5 7.3M8.6 13.2l6.9 3.5" stroke="currentColor" stroke-width="2"/></svg>
        </div>
        <div>
          <div class="kpi-value">0</div>
          <div class="kpi-label">Provincial Roads</div>
        </div>
      </article>

      <article class="kpi-card">
        <div class="kpi-icon i-len" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><path d="M12 21s7-5.3 7-11a7 7 0 1 0-14 0c0 5.7 7 11 7 11Z" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="10" r="2.5" stroke="currentColor" stroke-width="2"/></svg>
        </div>
        <div>
          <div class="kpi-value">0 km</div>
          <div class="kpi-label">Total Length</div>
        </div>
      </article>

      <article class="kpi-card">
        <div class="kpi-icon i-eq" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><rect x="4" y="5" width="9" height="14" rx="2" stroke="currentColor" stroke-width="2"/><path d="M13 11h3l4 4v4h-2a2 2 0 0 1-2-2v-1h-3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </div>
        <div>
          <div class="kpi-value">0</div>
          <div class="kpi-label">Equipment</div>
        </div>
      </article>

      <article class="kpi-card">
        <div class="kpi-icon i-task" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none"><rect x="4" y="6" width="16" height="14" rx="2" stroke="currentColor" stroke-width="2"/><path d="M8 3v5M16 3v5M4 10h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </div>
        <div>
          <div class="kpi-value">0</div>
          <div class="kpi-label">Scheduled Tasks</div>
        </div>
      </article>
    </section>

    <section class="tabs" aria-label="Maintenance dashboard tabs">
      <button type="button" class="tab active">Provincial Roads</button>
      <button type="button" class="tab">Equipment</button>
      <button type="button" class="tab">Maintenance Schedules</button>
    </section>

    <section class="condition-grid" aria-label="Road condition summary">
      <article class="condition-card">
        <div class="condition-head">
          <h3>Good Condition</h3>
          <span class="badge good">0</span>
        </div>
        <div class="progress"><span class="p-good"></span></div>
      </article>

      <article class="condition-card">
        <div class="condition-head">
          <h3>Fair Condition</h3>
          <span class="badge fair">0</span>
        </div>
        <div class="progress"><span class="p-fair"></span></div>
      </article>

      <article class="condition-card">
        <div class="condition-head">
          <h3>Poor Condition</h3>
          <span class="badge poor">0</span>
        </div>
        <div class="progress"><span class="p-poor"></span></div>
      </article>

      <article class="condition-card">
        <div class="condition-head">
          <h3>Bad Condition</h3>
          <span class="badge bad">0</span>
        </div>
        <div class="progress"><span class="p-bad"></span></div>
      </article>
    </section>

    <section class="filter-card" aria-label="Road filters">
      <div class="filter-row">
        <label class="search-field" for="road-search">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="11" cy="11" r="6.5" stroke="currentColor" stroke-width="2"/><path d="M16 16L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <input id="road-search" type="search" placeholder="Search roads..." autocomplete="off">
        </label>

        <div class="menu-select" data-name="municipality">
          <input type="hidden" name="municipality" value="all">
          <button type="button" class="menu-button" aria-expanded="false" aria-haspopup="listbox">
            <span class="button-label">All Municipalities</span>
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="m6 9 6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <div class="menu-list" role="listbox">
            <button type="button" class="menu-option active" data-value="all" data-label="All Municipalities"><span>All Municipalities</span><span class="option-check">✓</span></button>
          </div>
        </div>

        <div class="menu-select" data-name="condition">
          <input type="hidden" name="condition" value="all">
          <button type="button" class="menu-button" aria-expanded="false" aria-haspopup="listbox">
            <span class="button-label">All Conditions</span>
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="m6 9 6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <div class="menu-list" role="listbox">
            <button type="button" class="menu-option active" data-value="all" data-label="All Conditions"><span>All Conditions</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="good" data-label="Good"><span>Good</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="fair" data-label="Fair"><span>Fair</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="poor" data-label="Poor"><span>Poor</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="bad" data-label="Bad"><span>Bad</span><span class="option-check">✓</span></button>
          </div>
        </div>

        <div class="menu-select" data-name="sort_by">
          <input type="hidden" name="sort_by" value="road_id">
          <button type="button" class="menu-button" aria-expanded="false" aria-haspopup="listbox">
            <span class="button-label">Road ID</span>
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="m6 9 6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <div class="menu-list" role="listbox">
            <button type="button" class="menu-option active" data-value="road_id" data-label="Road ID"><span>Road ID</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="road_name" data-label="Road Name"><span>Road Name</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="municipality" data-label="Municipality"><span>Municipality</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="length" data-label="Length"><span>Length</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="condition" data-label="Condition"><span>Condition</span><span class="option-check">✓</span></button>
          </div>
        </div>

        <div class="menu-select" data-name="sort_order">
          <input type="hidden" name="sort_order" value="asc">
          <button type="button" class="menu-button" aria-expanded="false" aria-haspopup="listbox">
            <span class="button-label">Ascending</span>
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="m6 9 6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <div class="menu-list" role="listbox">
            <button type="button" class="menu-option active" data-value="asc" data-label="Ascending"><span>Ascending</span><span class="option-check">✓</span></button>
            <button type="button" class="menu-option" data-value="desc" data-label="Descending"><span>Descending</span><span class="option-check">✓</span></button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var selects = document.querySelectorAll(".menu-select");

      function closeAll(exceptNode) {
        selects.forEach(function (node) {
          if (node !== exceptNode) {
            node.classList.remove("open");
            var nodeBtn = node.querySelector(".menu-button");
            if (nodeBtn) {
              nodeBtn.setAttribute("aria-expanded", "false");
            }
          }
        });
      }

      selects.forEach(function (select) {
        var button = select.querySelector(".menu-button");
        var label = select.querySelector(".button-label");
        var hiddenInput = select.querySelector("input[type='hidden']");
        var options = select.querySelectorAll(".menu-option");

        if (!button || !options.length || !label) {
          return;
        }

        button.addEventListener("click", function (event) {
          event.preventDefault();
          var willOpen = !select.classList.contains("open");
          closeAll(select);
          select.classList.toggle("open", willOpen);
          button.setAttribute("aria-expanded", String(willOpen));
        });

        options.forEach(function (option) {
          option.addEventListener("click", function () {
            options.forEach(function (opt) {
              opt.classList.remove("active");
            });

            option.classList.add("active");

            var nextLabel = option.getAttribute("data-label") || option.textContent.trim();
            var nextValue = option.getAttribute("data-value") || nextLabel;

            label.textContent = nextLabel;
            if (hiddenInput) {
              hiddenInput.value = nextValue;
            }

            select.classList.remove("open");
            button.setAttribute("aria-expanded", "false");
          });
        });
      });

      document.addEventListener("click", function (event) {
        if (!event.target.closest(".menu-select")) {
          closeAll(null);
        }
      });

      document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
          closeAll(null);
        }
      });
    });
  </script>
</body>
</html>
