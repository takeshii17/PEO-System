{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'CSS/styles.css' %}">
    <title>PEO Portal - Construction Division</title>
     <style>
        :root { --bg:#eef1f5; --line:#ced5de; --text:#0c2137; }
        * { box-sizing: border-box; }
        html, body { margin:0; min-height:100%; font-family:"Sora","Segoe UI",sans-serif; color:var(--text); background:var(--bg); }
        .app-shell { display:flex; min-height:100vh; }
        .sidebar { width:340px; background:linear-gradient(180deg,#08274a 0%,#07203f 100%); color:#d5dfeb; border-right:1px solid #15385f; display:flex; flex-direction:column; }
        .brand { display:flex; gap:14px; align-items:center; padding:30px 26px; border-bottom:1px solid rgba(215,229,245,.16); }
        .brand-logo { width:58px; height:58px; border-radius:12px; border:1px solid rgba(207,220,235,.4); background:transparent url("{% static 'images/peo-logo.png' %}") center/contain no-repeat; display:grid; place-items:center; box-shadow:0 2px 6px rgba(10,33,58,.25); }
        .brand h1 { margin:0; font-size:clamp(1.2rem,1.85vw,2.05rem); color:#f4f7fb; }
        .brand p { margin:4px 0 0; font-size:1rem; color:#bdcada; }
        .nav-menu { padding:20px 16px 24px; display:grid; gap:8px; }
        .nav-item { display:flex; gap:12px; align-items:center; color:#c7d5e5; text-decoration:none; border-radius:14px; padding:14px 16px; font-size:clamp(1.05rem,1.22vw,2rem); line-height:1.15; }
        .nav-item:hover { background:rgba(255,255,255,.08); }
        .nav-item.active { background:#123760; color:#fff; box-shadow:inset 0 0 0 1px rgba(189,214,238,.08); font-weight:600; }
        .nav-icon { width:22px; height:22px; flex:0 0 auto; opacity:.95; }
        .workspace { flex:1; min-width:0; background:#f2f4f7; }
        .topbar { height:92px; border-bottom:1px solid var(--line); display:flex; justify-content:flex-end; align-items:center; padding:0 28px; background:#f5f7fa; }
        .account { display:flex; align-items:center; gap:14px; }
        .seal { width:52px; height:52px; border-radius:50%; border:2px solid #d2d9e1; background: #ffffff url("{% static 'images/prov-logo.png' %}") center/cover no-repeat; display:grid; place-items:center; font-size:.56rem; font-weight:700; color:#0b2a4c; text-align:center; line-height:1.15; }
        .avatar { width:42px; height:42px; border-radius:50%; background:#0f3459; color:#f2f7ff; display:grid; place-items:center; font-size:1.15rem; font-weight:700; text-transform:uppercase; }
        .logout-form { margin:0; }
        .logout-btn { border:0; background:transparent; color:#0b213a; font-size:1.05rem; padding:8px 10px; border-radius:10px; cursor:pointer; }
        .page { padding:24px; }
        .page h2 { margin:0; font-size:1.85rem; color:#1f2937; }
        .subhead { margin-top:10px; display:flex; gap:10px; align-items:center; color:#5b6675; font-size:.95rem; }
        .chip { display:inline-flex; align-items:center; padding:4px 10px; border:1px solid #f2bc94; border-radius:999px; color:#c2410c; background:#fff4ec; font-size:.86rem; }
        .card { margin-top:20px; background:#f8fafc; border:1px solid #c9d2de; border-radius:12px; box-shadow:0 1px 4px rgba(8,34,61,.1); padding:20px; display:block; }
        .card h3 { margin:0; font-size:1rem; }
        .report-head { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
        .table-wrap {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            border: 1px solid #cfd8e4;
            border-radius: 12px;
            background: #ffffff;
        }
        .column-table {
            width: max-content;
            min-width: 1800px;
            border-collapse: collapse;
            margin-top: 0;
            font-size: .82rem;
        }
        .column-table th, .column-table td {
            border: 1px solid #cfd8e4;
            padding: 8px;
            text-align: center;
            white-space: nowrap;
        }
        .column-table th {
            position: sticky;
            top: 0;
            background: #f4f7fa;
            z-index: 2;
        }
        .column-table td { background:#fff; }
        .column-table th:first-child {
            position: sticky;
            left: 0;
            z-index: 3;
            background: #f4f7fa;
        }
        .column-table td:first-child {
            position: sticky;
            left: 0;
            z-index: 1;
            background: #ffffff;
        }
        .toolbar { margin-top:0; display:flex; justify-content:flex-end; }
        .btn { border:1px solid #123760; background:#123760; color:#fff; border-radius:8px; padding:8px 12px; font-size:.82rem; cursor:pointer; }
        .btn.light { background:#fff; color:#123760; }
        .actions { display:flex; gap:6px; justify-content:center; }
        .no-data { color:#5f6f84; text-align:center; padding:10px 0; }
        .modal { position:fixed; inset:0; background:rgba(11,22,38,.45); display:none; align-items:center; justify-content:center; z-index:50; }
        .modal.show { display:flex; }
        .modal-card { width:min(980px,94vw); max-height:90vh; overflow:auto; background:#f7f9fc; border:1px solid #c9d2de; border-radius:12px; box-shadow:0 10px 28px rgba(0,0,0,.22); }
        .modal-head { padding:14px 16px; border-bottom:1px solid #d5dde8; display:flex; justify-content:space-between; align-items:center; }
        .modal-head h3 { margin:0; font-size:1rem; }
        .modal-body { padding:14px 16px; }
        .form-grid { display:grid; grid-template-columns:repeat(4, minmax(150px, 1fr)); gap:10px; }
        .field label { display:block; margin-bottom:4px; font-size:.75rem; color:#334961; font-weight:600; }
        .field input, .field textarea { width:100%; border:1px solid #bfcbd9; border-radius:8px; padding:8px; font-size:.8rem; font-family:inherit; background:#fff; }
        .field.wide { grid-column:span 4; }
        .modal-actions { margin-top:12px; display:flex; justify-content:flex-end; gap:8px; }
        .form-errors { margin:0 0 10px; padding:10px 12px; border-radius:8px; background:#fee2e2; color:#991b1b; font-size:.86rem; }

        /* When loaded from Home dashboard iframe (?embedded=1), render content-only. */
        body.embedded-maintenance-view .app-shell { display:block; min-height:auto; }
        body.embedded-maintenance-view .sidebar,
        body.embedded-maintenance-view .topbar { display:none; }
        body.embedded-maintenance-view .workspace { width:100%; }
        body.embedded-maintenance-view .page { padding:16px; }

        @media (max-width:1200px) { .sidebar { width:280px; } }
        @media (max-width:1024px) {
            .page { padding:12px; }
            .column-table { min-width:1450px; font-size:.76rem; }
            .column-table th, .column-table td { padding:6px; }
            .btn { font-size:.76rem; padding:6px 8px; }
        }
        @media (max-width:900px) {
            .app-shell { flex-direction:column; }
            .sidebar { width:100%; }
            .topbar { height:auto; padding:12px 16px; }
            .form-grid { grid-template-columns:1fr; }
            .field.wide { grid-column:span 1; }
            .column-table { min-width:1250px; font-size:.72rem; }
            .actions { flex-direction:column; align-items:stretch; }
            .actions .btn { width:100%; }
        }
    </style>
</head>
<body{% if request.GET.embedded %} class="embedded-maintenance-view"{% endif %}>
<div class="app-shell">
    <aside class="sidebar">
        <div class="brand">
            <div class="brand-logo" aria-label="PEO Seal"></div>
            <div><h1>PEO Portal</h1><p>Workflow Management</p></div>
        </div>
        <nav class="nav-menu">
            {% with current_page=request.resolver_match.url_name %}
            <a class="nav-item {% if current_page == 'home' or current_page == 'dashboard' %}active{% endif %}" href="{% url 'home' %}">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="3" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/>
                    <rect x="14" y="3" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/>
                    <rect x="3" y="14" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/>
                    <rect x="14" y="14" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/>
                </svg>
                Dashboard
            </a>
            <a class="nav-item {% if current_page == 'admin_div_dashboard' or current_page == 'admin_division' or current_page == 'admin_div_dashboard_legacy' %}active{% endif %}" href="{% url 'admin_div_dashboard' %}"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"><path d="M7 20v-2a4 4 0 0 1 4-4h2a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/><path d="M3 10c0-1.7 1.3-3 3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>Admin Division</a>
            <a class="nav-item {% if current_page == 'planning_div_dashboard' or current_page == 'planning_division' %}active{% endif %}" href="{% url 'planning_div_dashboard' %}"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"><rect x="5" y="3" width="14" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M9 7h6M9 11h6M9 15h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>Planning Division</a>
            <a class="nav-item {% if current_page == 'projects' %}active{% endif %}" href="{% url 'projects' %}"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"><path d="M4 6h12l4 4v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2"/><path d="M14 6v4h4M7 13h6M7 17h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>Projects</a>
            <a class="nav-item {% if current_page == 'construction_div_dashboard' or current_page == 'construction_division' %}active{% endif %}" href="{% url 'construction_div_dashboard' %}"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"><path d="M14 5 5 14l-1 5 5-1 9-9-4-4Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="m13 6 4 4" stroke="currentColor" stroke-width="2"/></svg>Construction Division</a>
            <a class="nav-item {% if current_page == 'quality_div_dashboard' or current_page == 'quality_division' %}active{% endif %}" href="{% url 'quality_div_dashboard' %}"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"><path d="M12 3 5 6v6c0 5 3.5 7.5 7 9 3.5-1.5 7-4 7-9V6l-7-3Z" stroke="currentColor" stroke-width="2"/><path d="m9 12 2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>Quality Division</a>
            <a class="nav-item {% if current_page == 'maintinance_div_dashboard' or current_page == 'maintinance_division' or current_page == 'maintinance_management' or current_page == 'maintenance_div_dashboard' or current_page == 'maintenance_division' or current_page == 'maintenance_management' %}active{% endif %}" href="{% url 'maintinance_div_dashboard' %}"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"><path d="m14 6-8 8 4 4 8-8-4-4Z" stroke="currentColor" stroke-width="2"/><path d="M6 14 4 20l6-2" stroke="currentColor" stroke-width="2"/></svg>Maintenance Division</a>
            <a class="nav-item {% if current_page == 'my_assignments' or current_page == 'my_assignments_template_alias' %}active{% endif %}" href="{% url 'my_assignments' %}"><svg class="nav-icon" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="m9.5 12 1.7 1.7L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>My Assignments</a>
            {% endwith %}
        </nav>
    </aside>

    <div class="workspace">
        <header class="topbar">
            <div class="account">
                <div class="seal" aria-label="Provincial Logo"></div>
                <div class="avatar">{{ user.username|slice:":1"|upper }}</div>
                <form class="logout-form" action="{% url 'logout' %}" method="post">{% csrf_token %}<button class="logout-btn" type="submit">Logout</button></form>
            </div>
        </header>

        <main class="page">
            <h2>Construction Division</h2>
            <div class="subhead"><span class="chip">Construction Division</span><span>Project Implementation &amp; Supervision</span></div>
            <section class="card">
                <div class="report-head">
                    <h3>Physical Accomplishment Status Report</h3>
                    <div class="toolbar">
                        <button class="btn" type="button" id="openReportModal">+ Add Record</button>
                    </div>
                </div>
                <div class="table-wrap">
                <table class="column-table">
                    <thead>
                        <tr>
                            <th rowspan="2">#</th>
                            <th rowspan="2">Project Name</th>
                            <th rowspan="2">Location</th>
                            <th rowspan="2">MUN</th>
                            <th rowspan="2">Contractor</th>
                            <th rowspan="2">Contract Cost</th>
                            <th rowspan="2">NTP Date</th>
                            <th rowspan="2">C.D</th>
                            <th colspan="3">Contract Period</th>
                            <th rowspan="2">Date Completed</th>
                            <th rowspan="2">Revised Contract Cost</th>
                            <th colspan="2">Status (%) DECEMBER 2025</th>
                            <th rowspan="2">% of Time Elapsed</th>
                            <th rowspan="2">Slippage (+) (-) %</th>
                            <th rowspan="2">Remarks</th>
                            <th rowspan="2">Actions</th>
                        </tr>
                        <tr>
                            <th>Original Expiry Date</th>
                            <th>Add'l. C.D</th>
                            <th>Revised Expiry Date</th>
                            <th>Previous</th>
                            <th>Current</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for report in reports %}
                        <tr>
                            <td>{{ forloop.counter }}</td>
                            <td>{{ report.project_name }}</td>
                            <td>{{ report.location|default:"-" }}</td>
                            <td>{{ report.mun|default:"-" }}</td>
                            <td>{{ report.contractor|default:"-" }}</td>
                            <td>{% if report.contract_cost %}{{ report.contract_cost }}{% else %}-{% endif %}</td>
                            <td>{% if report.ntp_date %}{{ report.ntp_date|date:"d-M-Y" }}{% else %}-{% endif %}</td>
                            <td>{{ report.cd|default:"-" }}</td>
                            <td>{% if report.original_expiry_date %}{{ report.original_expiry_date|date:"d-M-Y" }}{% else %}-{% endif %}</td>
                            <td>{{ report.additional_cd|default:"-" }}</td>
                            <td>{{ report.revised_expiry_date|default:"-" }}</td>
                            <td>{% if report.date_completed %}{{ report.date_completed|date:"d-M-Y" }}{% else %}-{% endif %}</td>
                            <td>{% if report.revised_contract_cost %}{{ report.revised_contract_cost }}{% else %}-{% endif %}</td>
                            <td>{{ report.status_previous|default:"-" }}</td>
                            <td>{{ report.status_current|default:"-" }}</td>
                            <td>{% if report.percent_time_elapsed %}{{ report.percent_time_elapsed }}{% else %}-{% endif %}</td>
                            <td>{% if report.slippage_percent %}{{ report.slippage_percent }}{% else %}-{% endif %}</td>
                            <td>{{ report.remarks|default:"-" }}</td>
                            <td>
                                <div class="actions">
                                    <a class="btn light" href="?edit={{ report.id }}{% if request.GET.embedded %}&embedded=1{% endif %}">Edit</a>
                                    <form method="post">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="delete">
                                        <input type="hidden" name="delete_id" value="{{ report.id }}">
                                        {% if request.GET.embedded %}
                                        <input type="hidden" name="embedded" value="1">
                                        {% endif %}
                                        <button class="btn light" type="submit">Delete</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="19" class="no-data">No records yet.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>
            </section>
        </main>
    </div>
</div>
<div class="modal {% if show_report_modal %}show{% endif %}" id="reportModal">
    <div class="modal-card">
        <div class="modal-head">
            <h3>{% if editing_report %}Edit Report Record{% else %}Create Report Record{% endif %}</h3>
        </div>
        <div class="modal-body">
            {% if report_form.errors %}
            <div class="form-errors">
                Please correct the highlighted fields and submit again.
            </div>
            {% endif %}
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="{% if editing_report %}update{% else %}create{% endif %}">
                {% if request.GET.embedded %}
                <input type="hidden" name="embedded" value="1">
                {% endif %}
                {% if editing_report %}
                <input type="hidden" name="report_id" value="{{ editing_report.id }}">
                {% endif %}
                <div class="form-grid">
                    <div class="field"><label>Project Name *</label>{{ report_form.project_name }}</div>
                    <div class="field"><label>Location</label>{{ report_form.location }}</div>
                    <div class="field"><label>MUN</label>{{ report_form.mun }}</div>
                    <div class="field"><label>Contractor</label>{{ report_form.contractor }}</div>
                    <div class="field"><label>Contract Cost</label>{{ report_form.contract_cost }}</div>
                    <div class="field"><label>NTP Date</label>{{ report_form.ntp_date }}</div>
                    <div class="field"><label>C.D</label>{{ report_form.cd }}</div>
                    <div class="field"><label>Original Expiry Date</label>{{ report_form.original_expiry_date }}</div>
                    <div class="field"><label>Add'l. C.D</label>{{ report_form.additional_cd }}</div>
                    <div class="field"><label>Revised Expiry Date</label>{{ report_form.revised_expiry_date }}</div>
                    <div class="field"><label>Date Completed</label>{{ report_form.date_completed }}</div>
                    <div class="field"><label>Revised Contract Cost</label>{{ report_form.revised_contract_cost }}</div>
                    <div class="field"><label>Previous</label>{{ report_form.status_previous }}</div>
                    <div class="field"><label>Current</label>{{ report_form.status_current }}</div>
                    <div class="field"><label>% of Time Elapsed</label>{{ report_form.percent_time_elapsed }}</div>
                    <div class="field"><label>Slippage (+) (-) %</label>{{ report_form.slippage_percent }}</div>
                    <div class="field wide"><label>Remarks</label>{{ report_form.remarks }}</div>
                </div>
                <div class="modal-actions">
                    <button class="btn light" type="button" id="cancelReportModal">Cancel</button>
                    <button class="btn" type="submit">{% if editing_report %}Update{% else %}Create{% endif %}</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    (function () {
        const modal = document.getElementById("reportModal");
        const openBtn = document.getElementById("openReportModal");
        const closeBtn = document.getElementById("closeReportModal");
        const cancelBtn = document.getElementById("cancelReportModal");
        const closeUrl = "{% url 'construction_div_dashboard' %}{% if request.GET.embedded %}?embedded=1{% endif %}";
        function openModal() { modal.classList.add("show"); }
        function closeModal() { window.location.href = closeUrl; }
        if (openBtn) openBtn.addEventListener("click", openModal);
        if (closeBtn) closeBtn.addEventListener("click", closeModal);
        if (cancelBtn) cancelBtn.addEventListener("click", closeModal);
        if (modal) {
            modal.addEventListener("click", function (event) {
                if (event.target === modal) closeModal();
            });
        }
    })();
</script>
</body>
</html>





