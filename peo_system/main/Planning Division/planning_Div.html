<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning Division Dashboard</title>
    <style>
        :root {
            --bg: #eef1f5;
            --panel: #f5f7fa;
            --line: #ccd3dc;
            --text: #0c2137;
            --muted: #5a6e86;
            --sidebar: #072645;
            --sidebar-soft: #10385f;
            --primary: #123a63;
            --chip: #dce7f7;
            --shadow: 0 2px 8px rgba(8, 32, 57, 0.1);
            --radius: 18px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: "Sora", "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        .layout {
            min-height: 100vh;
            display: block;
        }

        .sidebar { display: none; }

        .brand {
            padding: 28px 24px;
            border-bottom: 1px solid rgba(211, 223, 238, 0.18);
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .logo {
            width: 58px;
            height: 58px;
            border-radius: 12px;
            border: 2px solid #f0d364;
            background: radial-gradient(circle at 35% 35%, #ffe889 0%, #f8ca22 60%, #e0a90a 100%);
            color: #8a0010;
            font-weight: 700;
            font-size: 0.8rem;
            display: grid;
            place-items: center;
        }

        .brand h1 {
            margin: 0;
            color: #f4f8fe;
            font-size: clamp(1.1rem, 1.65vw, 1.85rem);
        }

        .brand p {
            margin: 4px 0 0;
            color: #c2d0df;
            font-size: 0.92rem;
        }

        .nav {
            padding: 18px 16px;
            display: grid;
            gap: 8px;
        }

        .nav a {
            color: #c9d8e8;
            text-decoration: none;
            border-radius: 14px;
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
        }

        .nav a:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .nav a.active {
            background: #113861;
            color: #ffffff;
            font-weight: 600;
        }

        .nav svg {
            width: 22px;
            height: 22px;
            flex: 0 0 auto;
        }

        .caret {
            margin-left: auto;
        }

        .content {
            min-width: 0;
            width: 100%;
        }

        .topbar { display: none; }

        .title-wrap h2 {
            margin: 0;
            font-size: 1.55rem;
        }

        .title-sub {
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            color: var(--muted);
            font-size: 0.82rem;
        }

        .division-chip {
            border: 1px solid #b8ccf0;
            background: var(--chip);
            color: #1a58a7;
            border-radius: 999px;
            padding: 3px 10px;
            font-weight: 600;
            font-size: 0.95em;
        }

        .profile {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .seal {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            border: 2px solid #cfd7e1;
            background: radial-gradient(circle at 35% 35%, #f1f9ff 0%, #dbe8f7 45%, #b9cade 100%);
            color: #0f2e53;
            font-size: 0.54rem;
            font-weight: 700;
            line-height: 1.12;
            display: grid;
            place-items: center;
            text-align: center;
        }

        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: #0f365f;
            color: #ffffff;
            display: grid;
            place-items: center;
            font-weight: 700;
            font-size: 1.15rem;
        }

        .logout {
            border: 0;
            background: transparent;
            color: #182d43;
            font-size: 0.95rem;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 8px;
        }

        .logout:hover {
            background: #e6edf6;
        }

        .main {
            padding: 24px 26px;
        }

        .section-tabs {
            width: min(780px, 100%);
            background: #dfe3e8;
            border-radius: 14px;
            padding: 4px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin-bottom: 22px;
        }

        .section-tab {
            border: 0;
            border-radius: 11px;
            padding: 9px 12px;
            background: transparent;
            color: #0d253e;
            font-family: inherit;
            font-size: 0.84rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }

        .section-tab.active {
            background: #f7f9fb;
            box-shadow: 0 1px 3px rgba(15, 39, 63, 0.12);
            font-weight: 600;
        }

        .section-tab svg {
            width: 20px;
            height: 20px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, minmax(190px, 1fr));
            gap: 16px;
            margin-bottom: 28px;
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--line);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            min-height: 150px;
            padding: 22px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .card-icon {
            width: 56px;
            height: 56px;
            border-radius: 18px;
            display: grid;
            place-items: center;
        }

        .card-icon svg {
            width: 28px;
            height: 28px;
        }

        .blue { background: #d7e4f7; color: #2267d8; }
        .green { background: #cdeed9; color: #109145; }
        .gold { background: #f6e9c2; color: #d98600; }
        .violet { background: #e6daf8; color: #9738f7; }

        .card strong {
            display: block;
            font-size: 1.2rem;
            line-height: 1;
        }

        .card span {
            color: #4d627b;
            font-size: 0.8rem;
        }

        .budget-panel {
            background: var(--panel);
            border: 1px solid var(--line);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 26px 28px 22px;
        }

        .panel-head {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .panel-head h3 {
            margin: 0;
            font-size: 1.05rem;
        }

        .panel-head p {
            margin: 4px 0 0;
            color: #4f637c;
            font-size: 0.8rem;
        }

        .new-budget {
            border: 0;
            background: #10385f;
            color: #ffffff;
            border-radius: 14px;
            padding: 11px 18px;
            font-size: 0.82rem;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .budget-item {
            background: #f8fafc;
            border: 1px solid #cdd4dd;
            border-radius: 16px;
            padding: 18px 18px 16px;
            margin-top: 14px;
        }

        .item-top {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            align-items: flex-start;
        }

        .title-line {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .title-line h4 {
            margin: 0;
            font-size: 0.98rem;
        }

        .title-line a {
            color: inherit;
            text-decoration: none;
        }

        .title-line a:hover {
            text-decoration: underline;
        }

        .status {
            background: #153d66;
            color: #ffffff;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .meta {
            display: grid;
            grid-template-columns: repeat(3, minmax(180px, 1fr));
            gap: 8px 16px;
            margin: 4px 0 10px;
            color: #4a607b;
            font-size: 0.8rem;
        }

        .meta strong {
            color: #0e2238;
            font-weight: 700;
        }

        .ok {
            color: #0d9d42;
            font-weight: 700;
        }

        .icon-actions {
            display: flex;
            gap: 8px;
        }

        .icon-actions form {
            margin: 0;
        }

        .icon-btn {
            border: 1px solid #cdd4de;
            background: #ffffff;
            width: 44px;
            height: 40px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            cursor: pointer;
            color: #0e243c;
        }

        button.icon-btn {
            font-family: inherit;
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
        }

        .util-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 6px;
            color: #2f4560;
            font-size: 0.8rem;
        }

        .progress {
            height: 10px;
            border-radius: 999px;
            background: #dce3eb;
            overflow: hidden;
        }

        .progress > span {
            display: block;
            height: 100%;
            width: 100%;
            background: #123d67;
        }

        .pow-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .pow-tools {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .pow-tools input,
        .pow-tools select {
            border: 1px solid #c5ced9;
            border-radius: 10px;
            background: #f7f9fb;
            color: #21354a;
            padding: 9px 10px;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .pow-tools input {
            min-width: 230px;
        }

        .pow-empty {
            border: 1px solid #d2d9e2;
            border-radius: 14px;
            min-height: 130px;
            margin-top: 14px;
            display: grid;
            place-items: center;
            color: #5c6f87;
            font-size: 1rem;
            text-align: center;
            padding: 16px;
            background: #f8fafc;
        }

        .pow-table {
            width: 100%;
            margin-top: 12px;
            border-collapse: collapse;
            background: #f8fafc;
            border: 1px solid #d2d9e2;
            border-radius: 12px;
            overflow: hidden;
        }

        .pow-table th,
        .pow-table td {
            border-bottom: 1px solid #dde3eb;
            padding: 9px 10px;
            font-size: 0.8rem;
            text-align: left;
        }

        .pow-table th {
            background: #eef3f8;
            color: #23384f;
            font-weight: 600;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(7, 21, 37, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 70;
            padding: 16px;
        }

        .modal.show {
            display: flex;
        }

        .modal-card {
            width: min(620px, 100%);
            background: #f8fafc;
            border: 1px solid #ccd4df;
            border-radius: 14px;
            box-shadow: 0 10px 28px rgba(7, 23, 43, 0.3);
        }

        .modal-head {
            border-bottom: 1px solid #d7dde6;
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-head h3 {
            margin: 0;
            font-size: 0.95rem;
        }

        .modal-body {
            padding: 12px 14px 14px;
        }

        .budget-form-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(180px, 1fr));
            gap: 10px;
        }

        .form-field label {
            display: block;
            margin-bottom: 4px;
            font-size: 0.76rem;
            color: #2f4762;
            font-weight: 600;
        }

        .form-field input,
        .form-field select {
            width: 100%;
            border: 1px solid #c3ceda;
            border-radius: 8px;
            padding: 8px 9px;
            font-family: inherit;
            font-size: 0.82rem;
            background: #ffffff;
        }

        .form-field.full {
            grid-column: span 2;
        }

        .modal-actions {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        @media (max-width: 1440px) {
            .sidebar {
                width: 282px;
            }

            .stats {
                grid-template-columns: repeat(2, minmax(220px, 1fr));
            }
        }

        @media (max-width: 980px) {
            .layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .topbar {
                flex-direction: column;
                align-items: stretch;
            }

            .profile {
                justify-content: flex-end;
            }

            .section-tabs {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            .meta {
                grid-template-columns: 1fr;
            }

            .budget-form-grid {
                grid-template-columns: 1fr;
            }

            .form-field.full {
                grid-column: span 1;
            }

            .item-top {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">
                <div class="logo">PEO</div>
                <div>
                    <h1>PEO Portal</h1>
                    <p>Workflow Management</p>
                </div>
            </div>

            <nav class="nav">
                <a href="{% url 'home' %}">
                    <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/><rect x="14" y="3" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/><rect x="3" y="14" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/><rect x="14" y="14" width="7" height="7" rx="1.8" stroke="currentColor" stroke-width="2"/></svg>
                    Dashboard
                </a>
                <a href="{% url 'admin_div_dashboard' %}">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M7 20v-2a4 4 0 0 1 4-4h2a4 4 0 0 1 4 4v2" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/></svg>
                    Admin Division
                </a>
                <a href="{% url 'planning_div_dashboard' %}" class="active">
                    <svg viewBox="0 0 24 24" fill="none"><rect x="5" y="3" width="14" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M9 7h6M9 11h6M9 15h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                    Planning Division
                    <span class="caret">&#8250;</span>
                </a>
                <a href="{% url 'construction_div_dashboard' %}">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M14 5 5 14l-1 5 5-1 9-9-4-4Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
                    Construction Division
                </a>
                <a href="{% url 'quality_div_dashboard' %}">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M12 3 5 6v6c0 5 3.5 7.5 7 9 3.5-1.5 7-4 7-9V6l-7-3Z" stroke="currentColor" stroke-width="2"/><path d="m9 12 2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                    Quality Division
                </a>
                <a href="{% url 'maintinance_div_dashboard' %}">
                    <svg viewBox="0 0 24 24" fill="none"><path d="m14 6-8 8 4 4 8-8-4-4Z" stroke="currentColor" stroke-width="2"/><path d="M6 14 4 20l6-2" stroke="currentColor" stroke-width="2"/></svg>
                    Maintenance Division
                </a>
                <a href="#">
                    <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="m9.5 12 1.7 1.7L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                    My Assignments
                </a>
                <a href="#">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M4 7h7M4 12h12M4 17h9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="17" cy="7" r="2" stroke="currentColor" stroke-width="2"/></svg>
                    Tasks
                </a>
                <a href="#">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-8Z" stroke="currentColor" stroke-width="2"/><path d="M8 11V8a4 4 0 0 1 8 0v3" stroke="currentColor" stroke-width="2"/></svg>
                    Contractors
                </a>
            </nav>
        </aside>

        <div class="content">
            <header class="topbar">
                <div class="title-wrap">
                    <h2>Planning Division</h2>
                    <div class="title-sub">
                        <span class="division-chip">Planning Division</span>
                        <span>Budget Allocation &amp; Program of Works Management</span>
                    </div>
                </div>
                <div class="profile">
                    <div class="seal">OFFICE<br>OF PEA</div>
                    <div class="avatar">L</div>
                    <button class="logout" type="button">Logout</button>
                </div>
            </header>

            <main class="main">
                <section class="section-tabs">
                    <a class="section-tab {% if active_tab == 'budget' %}active{% endif %}" href="{% url 'planning_div_dashboard' %}?tab=budget">
                        <svg viewBox="0 0 24 24" fill="none"><path d="M5 7h14v10a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7Z" stroke="currentColor" stroke-width="2"/><path d="M9 7V5h6v2M8 12h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        Budget
                    </a>
                    <a class="section-tab {% if active_tab == 'ppa' %}active{% endif %}" href="{% url 'planning_div_dashboard' %}?tab=ppa{% if selected_fund %}&fund={{ selected_fund }}{% endif %}">
                        <svg viewBox="0 0 24 24" fill="none"><rect x="5" y="3" width="14" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M9 7h6M9 11h6M9 15h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        PPA
                    </a>
                    <a class="section-tab {% if active_tab == 'timeline' %}active{% endif %}" href="{% url 'planning_div_dashboard' %}?tab=timeline">
                        <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M12 7v5l3 2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        Timeline
                    </a>
                </section>

                {% if active_tab == "budget" %}
                <section class="stats">
                    <article class="card">
                        <div class="card-icon blue">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M5 7h14v10a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V7Z" stroke="currentColor" stroke-width="2"/><path d="M9 7V5h6v2M8 12h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </div>
                        <div>
                            <strong>{{ total_budgets }}</strong>
                            <span>Total Budgets</span>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-icon green">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M12 3v18M16.5 7.5A4.5 4.5 0 0 0 12 5c-2.5 0-4 1.2-4 3s1.5 3 4 3 4 1.2 4 3-1.5 3-4 3a4.5 4.5 0 0 1-4.5-2.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </div>
                        <div>
                            <strong>PHP {{ total_allocated|floatformat:0 }}</strong>
                            <span>Total Allocated</span>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-icon gold">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M6 11h12v5a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3v-5Z" stroke="currentColor" stroke-width="2"/><path d="M7 11V9a5 5 0 0 1 10 0v2M5 13H3M21 13h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </div>
                        <div>
                            <strong>PHP {{ total_remaining|floatformat:0 }}</strong>
                            <span>Total Remaining</span>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-icon violet">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M4 16 10 10l4 4 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M20 12V8h-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </div>
                        <div>
                            <strong>FY 2026</strong>
                            <span>Current Year</span>
                        </div>
                    </article>
                </section>

                <section class="budget-panel">
                    <div class="panel-head">
                        <div>
                            <h3>Annual Budget Allocations</h3>
                            <p>Budget management</p>
                        </div>
                        <button class="new-budget" type="button">
                            <span>+</span>
                            <span>New Budget</span>
                        </button>
                    </div>

                    {% for budget in budgets %}
                    <article class="budget-item">
                        <div class="item-top">
                            <div>
                                <div class="title-line">
                                    <h4><a href="{% url 'planning_div_dashboard' %}?tab=ppa&fund={{ budget.fund }}">{{ budget.name }}</a></h4>
                                    <span class="status">{{ budget.get_status_display }}</span>
                                </div>
                                <div class="meta">
                                    <div>Total Budget: <strong>PHP {{ budget.total_budget|floatformat:0 }}</strong></div>
                                    <div>Allocated: <strong>PHP {{ budget.allocated_value|floatformat:0 }}</strong></div>
                                    <div>Remaining: <strong class="ok">PHP {{ budget.remaining_amount|floatformat:0 }}</strong></div>
                                </div>
                            </div>
                            <div class="icon-actions">
                                <a class="icon-btn" href="{% url 'planning_div_dashboard' %}?tab=budget&edit_budget={{ budget.id }}" aria-label="Edit">
                                    <svg viewBox="0 0 24 24" fill="none"><path d="m4 20 4.5-1 10-10-3.5-3.5-10 10L4 20Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="m13.5 6 3.5 3.5" stroke="currentColor" stroke-width="2"/></svg>
                                </a>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="delete_budget">
                                    <input type="hidden" name="delete_id" value="{{ budget.id }}">
                                    <button class="icon-btn" type="submit" aria-label="Delete">
                                        <svg viewBox="0 0 24 24" fill="none"><path d="M5 7h14M9 7V5h6v2M8 7v12m8-12v12M6 7l1 13a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="util-row">
                            <span>Utilization</span>
                            <strong>{{ budget.utilization_percent|floatformat:0 }}%</strong>
                        </div>
                        <div class="progress"><span style="width:{{ budget.utilization_percent|floatformat:0 }}%"></span></div>
                    </article>
                    {% empty %}
                    <article class="budget-item">
                        <div class="meta">No budget records yet.</div>
                    </article>
                    {% endfor %}
                </section>
                {% elif active_tab == "ppa" %}
                <section class="stats">
                    <article class="card">
                        <div class="card-icon blue">
                            <svg viewBox="0 0 24 24" fill="none"><rect x="5" y="3" width="14" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M9 7h6M9 11h6M9 15h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </div>
                        <div>
                            <strong>{{ ppa_total }}</strong>
                            <span>Total POWs</span>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-icon green">
                            <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="m8.5 12 2.2 2.2L15.5 9.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </div>
                        <div>
                            <strong>{{ ppa_approved }}</strong>
                            <span>Approved</span>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-icon gold">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M12 8v5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="16.5" r=".8" fill="currentColor"/><path d="M10 3h4l7 14H3L10 3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
                        </div>
                        <div>
                            <strong>{{ ppa_for_review }}</strong>
                            <span>For Review</span>
                        </div>
                    </article>
                    <article class="card">
                        <div class="card-icon violet">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M12 3v18M16.5 7.5A4.5 4.5 0 0 0 12 5c-2.5 0-4 1.2-4 3s1.5 3 4 3 4 1.2 4 3-1.5 3-4 3a4.5 4.5 0 0 1-4.5-2.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                        </div>
                        <div>
                            <strong>PHP {{ ppa_total_cost|floatformat:0 }}</strong>
                            <span>Total Cost</span>
                        </div>
                    </article>
                </section>

                <section class="budget-panel">
                    <div class="panel-head">
                        <div>
                            <h3>Program of Works</h3>
                            <p>Infrastructure projects linked to approved budgets</p>
                        </div>
                    </div>
                    <div class="pow-toolbar">
                        <form class="pow-tools" method="get">
                            <input type="hidden" name="tab" value="ppa">
                            <input type="text" name="q" value="{{ ppa_search }}" placeholder="Search..." />
                            <select name="status">
                                <option value="">All Statuses</option>
                                {% for value, label in project_status_choices %}
                                <option value="{{ value }}" {% if ppa_status == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                            <select name="fund_filter">
                                <option value="">All Funds</option>
                                {% for value, label in fund_choices %}
                                <option value="{{ value }}" {% if ppa_fund == value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                            <button class="icon-btn" type="submit" aria-label="Apply">Go</button>
                        </form>
                        <button class="new-budget" type="button" id="openProjectModal"><span>+</span><span>New POW</span></button>
                    </div>
                    {% if ppa_projects %}
                    <table class="pow-table">
                        <thead>
                            <tr>
                                <th>Project Title</th>
                                <th>Fund</th>
                                <th>Budget Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in ppa_projects %}
                            <tr>
                                <td>{{ project.project_title }}</td>
                                <td>{{ project.get_fund_display }}</td>
                                <td>PHP {{ project.budget_amount|floatformat:0 }}</td>
                                <td>{{ project.get_status_display }}</td>
                                <td>
                                    <form method="post">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="delete_project">
                                        <input type="hidden" name="project_id" value="{{ project.id }}">
                                        <button class="icon-btn" type="submit" aria-label="Delete">
                                            <svg viewBox="0 0 24 24" fill="none"><path d="M5 7h14M9 7V5h6v2M8 7v12m8-12v12M6 7l1 13a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <div class="pow-empty">No POWs found. Create a budget first, then add POWs.</div>
                    {% endif %}
                </section>
                {% else %}
                <section class="budget-panel">
                    <div class="panel-head">
                        <div>
                            <h3>Timeline</h3>
                            <p>Timeline tracking view is not configured yet.</p>
                        </div>
                    </div>
                </section>
                {% endif %}
            </main>
        </div>
    </div>
    <div class="modal {% if show_project_modal %}show{% endif %}" id="projectModal">
        <div class="modal-card">
            <div class="modal-head">
                <h3>New POW Project</h3>
                <button class="icon-btn" type="button" id="closeProjectModal" aria-label="Close">X</button>
            </div>
            <div class="modal-body">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="create_project">
                    <div class="budget-form-grid">
                        <div class="form-field full"><label>Project Title</label>{{ project_form.project_title }}</div>
                        <div class="form-field"><label>Fund Category</label>{{ project_form.fund }}</div>
                        <div class="form-field"><label>Budget Amount</label>{{ project_form.budget_amount }}</div>
                        <div class="form-field full"><label>Status</label>{{ project_form.status }}</div>
                    </div>
                    <div class="modal-actions">
                        <a class="icon-btn" href="{% url 'planning_div_dashboard' %}?tab=ppa{% if selected_fund %}&fund={{ selected_fund }}{% endif %}" aria-label="Cancel">Cancel</a>
                        <button class="new-budget" type="submit">Save Project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal {% if show_budget_modal %}show{% endif %}" id="budgetModal">
        <div class="modal-card">
            <div class="modal-head">
                <h3>Edit Budget</h3>
                <button class="icon-btn" type="button" id="closeBudgetModal" aria-label="Close">X</button>
            </div>
            <div class="modal-body">
                <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="update_budget">
                    {% if editing_budget %}
                    <input type="hidden" name="budget_id" value="{{ editing_budget.id }}">
                    {% endif %}
                    <div class="budget-form-grid">
                        <div class="form-field full"><label>Name</label>{{ budget_form.name }}</div>
                        <div class="form-field"><label>Fund</label>{{ budget_form.fund }}</div>
                        <div class="form-field"><label>Fiscal Year</label>{{ budget_form.fiscal_year }}</div>
                        <div class="form-field"><label>Total Budget</label>{{ budget_form.total_budget }}</div>
                        <div class="form-field"><label>Allocated Amount</label><input type="text" value="Auto-computed from POW projects" disabled></div>
                        <div class="form-field full"><label>Status</label>{{ budget_form.status }}</div>
                    </div>
                    <div class="modal-actions">
                        <a class="icon-btn" href="{% url 'planning_div_dashboard' %}?tab=budget" aria-label="Cancel">Cancel</a>
                        <button class="new-budget" type="submit">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        (function () {
            const projectModal = document.getElementById("projectModal");
            const openProjectBtn = document.getElementById("openProjectModal");
            const closeProjectBtn = document.getElementById("closeProjectModal");
            const modal = document.getElementById("budgetModal");
            const closeBtn = document.getElementById("closeBudgetModal");
            if (openProjectBtn && projectModal) {
                openProjectBtn.addEventListener("click", function () {
                    projectModal.classList.add("show");
                });
            }
            if (closeProjectBtn) {
                closeProjectBtn.addEventListener("click", function () {
                    window.location.href = "{% url 'planning_div_dashboard' %}?tab=ppa{% if selected_fund %}&fund={{ selected_fund }}{% endif %}";
                });
            }
            if (projectModal) {
                projectModal.addEventListener("click", function (event) {
                    if (event.target === projectModal) {
                        window.location.href = "{% url 'planning_div_dashboard' %}?tab=ppa{% if selected_fund %}&fund={{ selected_fund }}{% endif %}";
                    }
                });
            }
            if (closeBtn) {
                closeBtn.addEventListener("click", function () {
                    window.location.href = "{% url 'planning_div_dashboard' %}?tab=budget";
                });
            }
            if (modal) {
                modal.addEventListener("click", function (event) {
                    if (event.target === modal) {
                        window.location.href = "{% url 'planning_div_dashboard' %}?tab=budget";
                    }
                });
            }
        })();
    </script>
</body>
</html>
